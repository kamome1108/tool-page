module.exports=[78620,a=>{"use strict";var b=a.i(79903),c=a.i(349),d=a.i(5931),e=a.i(77089),f=a.i(2441),g=a.i(31220);function h(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class i{constructor(){this.listeners={}}on(a,b,c){if(this.listeners[a]||(this.listeners[a]=new Set),null==c?void 0:c.once){let c=(...d)=>{this.un(a,c),b(...d)};return this.listeners[a].add(c),()=>this.un(a,c)}return this.listeners[a].add(b),()=>this.un(a,b)}un(a,b){var c;null==(c=this.listeners[a])||c.delete(b)}once(a,b){return this.on(a,b,{once:!0})}unAll(){this.listeners={}}emit(a,...b){this.listeners[a]&&this.listeners[a].forEach(a=>a(...b))}}let j={decode:function(a,b){return h(this,void 0,void 0,function*(){let c=new AudioContext({sampleRate:b});try{return yield c.decodeAudioData(a)}finally{c.close()}})},createBuffer:function(a,b){if(!a||0===a.length)throw Error("channelData must be a non-empty array");if(b<=0)throw Error("duration must be greater than 0");if("number"==typeof a[0]&&(a=[a]),!a[0]||0===a[0].length)throw Error("channelData must contain non-empty channel arrays");!function(a){let b=a[0];if(b.some(a=>a>1||a<-1)){let c=b.length,d=0;for(let a=0;a<c;a++){let c=Math.abs(b[a]);c>d&&(d=c)}for(let b of a)for(let a=0;a<c;a++)b[a]/=d}}(a);let c=a.map(a=>a instanceof Float32Array?a:Float32Array.from(a));return{duration:b,length:c[0].length,sampleRate:c[0].length/b,numberOfChannels:c.length,getChannelData:a=>{let b=c[a];if(!b)throw Error(`Channel ${a} not found`);return b},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function k(a,b,c){let d=function a(b,c){let d=c.xmlns?document.createElementNS(c.xmlns,b):document.createElement(b);for(let[b,e]of Object.entries(c))if("children"===b&&e)for(let[b,c]of Object.entries(e))c instanceof Node?d.appendChild(c):"string"==typeof c?d.appendChild(document.createTextNode(c)):d.appendChild(a(b,c));else"style"===b?Object.assign(d.style,e):"textContent"===b?d.textContent=e:d.setAttribute(b,e.toString());return d}(a,b||{});return null==c||c.appendChild(d),d}var l=Object.freeze({__proto__:null,createElement:k,default:k});let m={fetchBlob:function(a,b,c){return h(this,void 0,void 0,function*(){let d=yield fetch(a,c);if(d.status>=400)throw Error(`Failed to fetch ${a}: ${d.status} (${d.statusText})`);return function(a,b){h(this,void 0,void 0,function*(){if(!a.body||!a.headers)return;let c=a.body.getReader(),d=Number(a.headers.get("Content-Length"))||0,e=0,f=a=>{b(Math.round((e+=(null==a?void 0:a.length)||0)/d*100))};try{for(;;){let a=yield c.read();if(a.done)break;f(a.value)}}catch(a){console.warn("Progress tracking error:",a)}})}(d.clone(),b),d.blob()})}};class n extends i{constructor(a){super(),this.isExternalMedia=!1,a.media?(this.media=a.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),a.mediaControls&&(this.media.controls=!0),a.autoplay&&(this.media.autoplay=!0),null!=a.playbackRate&&this.onMediaEvent("canplay",()=>{null!=a.playbackRate&&(this.media.playbackRate=a.playbackRate)},{once:!0})}onMediaEvent(a,b,c){return this.media.addEventListener(a,b,c),()=>this.media.removeEventListener(a,b,c)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let a=this.getSrc();a.startsWith("blob:")&&URL.revokeObjectURL(a)}canPlayType(a){return""!==this.media.canPlayType(a)}setSrc(a,b){let c=this.getSrc();if(a&&c===a)return;this.revokeSrc();let d=b instanceof Blob&&(this.canPlayType(b.type)||!a)?URL.createObjectURL(b):a;if(c&&this.media.removeAttribute("src"),d||a)try{this.media.src=d}catch(b){this.media.src=a}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(a){this.media=a}play(){return h(this,void 0,void 0,function*(){try{return yield this.media.play()}catch(a){if(a instanceof DOMException&&"AbortError"===a.name)return;throw a}})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(a){this.media.currentTime=Math.max(0,Math.min(a,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(a){this.media.volume=a}getMuted(){return this.media.muted}setMuted(a){this.media.muted=a}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(a,b){null!=b&&(this.media.preservesPitch=b),this.media.playbackRate=a}getMediaElement(){return this.media}setSinkId(a){return this.media.setSinkId(a)}}function o(a){return a<0?0:a>1?1:a}function p(a,b,c){let d=b-a.left,e=c-a.top;return[d/a.width,e/a.height]}function q(a){return!!(a.barWidth||a.barGap||a.barAlign)}function r(a,b){if(!q(b))return a;let c=b.barWidth||.5,d=c+(b.barGap||c/2);return 0===d?a:Math.floor(a/d)*d}function s({scrollLeft:a,totalWidth:b,numCanvases:c}){if(0===b)return[0];let d=Math.floor(a/b*c);return[d-1,d,d+1]}function t({scrollLeft:a,clientWidth:b,scrollWidth:c}){return 0===c?{startX:0,endX:0}:{startX:a/c,endX:(a+b)/c}}class u extends i{constructor(a,b){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=a;const c=this.parentFromOptionsContainer(a.container);this.parent=c;const[d,e]=this.initHtml();c.appendChild(d),this.container=d,this.scrollContainer=e.querySelector(".scroll"),this.wrapper=e.querySelector(".wrapper"),this.canvasWrapper=e.querySelector(".canvases"),this.progressWrapper=e.querySelector(".progress"),this.cursor=e.querySelector(".cursor"),b&&e.appendChild(b),this.initEvents()}parentFromOptionsContainer(a){let b;if("string"==typeof a?b=document.querySelector(a):a instanceof HTMLElement&&(b=a),!b)throw Error("Container not found");return b}initEvents(){if(this.wrapper.addEventListener("click",a=>{let[b,c]=p(this.wrapper.getBoundingClientRect(),a.clientX,a.clientY);this.emit("click",b,c)}),this.wrapper.addEventListener("dblclick",a=>{let[b,c]=p(this.wrapper.getBoundingClientRect(),a.clientX,a.clientY);this.emit("dblclick",b,c)}),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{let{scrollLeft:a,scrollWidth:b,clientWidth:c}=this.scrollContainer,{startX:d,endX:e}=t({scrollLeft:a,scrollWidth:b,clientWidth:c});this.emit("scroll",d,e,a,a+c)}),"function"==typeof ResizeObserver){let a=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{a().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let a=this.parent.clientWidth;a===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=a,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=function(a,b,c,d,e=3,f=0,g=100){if(!a)return()=>{};let h=new Map,i=matchMedia("(pointer: coarse)").matches,j=()=>{},k=k=>{if(k.button!==f||(h.set(k.pointerId,k),h.size>1))return;let l=k.clientX,m=k.clientY,n=!1,o=Date.now(),p=d=>{if(d.defaultPrevented||h.size>1||i&&Date.now()-o<g)return;let f=d.clientX,j=d.clientY,k=f-l,p=j-m;if(n||Math.abs(k)>e||Math.abs(p)>e){d.preventDefault(),d.stopPropagation();let{left:e,top:g}=a.getBoundingClientRect();n||(null==c||c(l-e,m-g),n=!0),b(k,p,f-e,j-g),l=f,m=j}},q=b=>{if(h.delete(b.pointerId),n){let c=b.clientX,e=b.clientY,{left:f,top:g}=a.getBoundingClientRect();null==d||d(c-f,e-g)}j()},r=a=>{h.delete(a.pointerId),a.relatedTarget&&a.relatedTarget!==document.documentElement||q(a)},s=a=>{n&&(a.stopPropagation(),a.preventDefault())},t=a=>{a.defaultPrevented||h.size>1||n&&a.preventDefault()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",q),document.addEventListener("pointerout",r),document.addEventListener("pointercancel",r),document.addEventListener("touchmove",t,{passive:!1}),document.addEventListener("click",s,{capture:!0}),j=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",q),document.removeEventListener("pointerout",r),document.removeEventListener("pointercancel",r),document.removeEventListener("touchmove",t),setTimeout(()=>{document.removeEventListener("click",s,{capture:!0})},10)}};return a.addEventListener("pointerdown",k),()=>{j(),a.removeEventListener("pointerdown",k),h.clear()}}(this.wrapper,(a,b,c)=>{let d=this.wrapper.getBoundingClientRect().width;this.emit("drag",o(c/d))},a=>{this.isDragging=!0;let b=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",o(a/b))},a=>{this.isDragging=!1;let b=this.wrapper.getBoundingClientRect().width;this.emit("dragend",o(a/b))}),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){let a=document.createElement("div"),b=a.attachShadow({mode:"open"}),c=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return b.innerHTML=`
      <style${c?` nonce="${c}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[a,b]}setOptions(a){if(this.options.container!==a.container){let b=this.parentFromOptionsContainer(a.container);b.appendChild(this.container),this.parent=b}!0!==a.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=a,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(a){this.scrollContainer.scrollLeft=a}setScrollPercentage(a){let{scrollWidth:b}=this.scrollContainer;this.setScroll(b*a)}destroy(){var a;this.subscriptions.forEach(a=>a()),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null==(a=this.unsubscribeOnScroll)||a.forEach(a=>a()),this.unsubscribeOnScroll=[]}createDelay(a=10){let b,c,d=()=>{b&&(clearTimeout(b),b=void 0),c&&(c(),c=void 0)};return this.timeouts.push(d),()=>new Promise((e,f)=>{d(),c=f,b=setTimeout(()=>{b=void 0,c=void 0,e()},a)})}getHeight(a,b){var c;let d=(null==(c=this.audioData)?void 0:c.numberOfChannels)||1;return function({optionsHeight:a,optionsSplitChannels:b,parentHeight:c,numberOfChannels:d,defaultHeight:e=128}){if(null==a)return e;let f=Number(a);if(!isNaN(f))return f;if("auto"===a){let a=c||e;return(null==b?void 0:b.every(a=>!a.overlay))?a/d:a}return e}({optionsHeight:a,optionsSplitChannels:b,parentHeight:this.parent.clientHeight,numberOfChannels:d,defaultHeight:128})}convertColorValues(a){return function(a,b){if(!Array.isArray(a))return a||"";if(0===a.length)return"#999";if(a.length<2)return a[0]||"";let c=document.createElement("canvas"),d=c.getContext("2d"),e=c.height*b,f=d.createLinearGradient(0,0,0,e||b),g=1/(a.length-1);return a.forEach((a,b)=>{f.addColorStop(b*g,a)}),f}(a,this.getPixelRatio())}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(a,b,c,d){let{width:e,height:f}=c.canvas,{halfHeight:g,barWidth:h,barRadius:i,barIndexScale:j,barSpacing:k}=function({width:a,height:b,length:c,options:d,pixelRatio:e}){let f=d.barWidth?d.barWidth*e:1,g=d.barGap?d.barGap*e:d.barWidth?f/2:0,h=f+g||1;return{halfHeight:b/2,barWidth:f,barGap:g,barRadius:d.barRadius||0,barIndexScale:c>0?a/h/c:0,barSpacing:h}}({width:e,height:f,length:(a[0]||[]).length,options:b,pixelRatio:this.getPixelRatio()}),l=function({channelData:a,barIndexScale:b,barSpacing:c,barWidth:d,halfHeight:e,vScale:f,canvasHeight:g,barAlign:h}){let i=a[0]||[],j=a[1]||i,k=i.length,l=[],m=0,n=0,o=0;for(let a=0;a<=k;a++){let k=Math.round(a*b);if(k>m){let{topHeight:a,totalHeight:b}=function({maxTop:a,maxBottom:b,halfHeight:c,vScale:d}){let e=Math.round(a*c*d);return{topHeight:e,totalHeight:e+Math.round(b*c*d)||1}}({maxTop:n,maxBottom:o,halfHeight:e,vScale:f}),i=function({barAlign:a,halfHeight:b,topHeight:c,totalHeight:d,canvasHeight:e}){return"top"===a?0:"bottom"===a?e-d:b-c}({barAlign:h,halfHeight:e,topHeight:a,totalHeight:b,canvasHeight:g});l.push({x:m*c,y:i,width:d,height:b}),m=k,n=0,o=0}let p=Math.abs(i[a]||0),q=Math.abs(j[a]||0);p>n&&(n=p),q>o&&(o=q)}return l}({channelData:a,barIndexScale:j,barSpacing:k,barWidth:h,halfHeight:g,vScale:d,canvasHeight:f,barAlign:b.barAlign});for(let a of(c.beginPath(),l))i&&"roundRect"in c?c.roundRect(a.x,a.y,a.width,a.height,i):c.rect(a.x,a.y,a.width,a.height);c.fill(),c.closePath()}renderLineWaveform(a,b,c,d){let{width:e,height:f}=c.canvas,g=function({channelData:a,width:b,height:c,vScale:d}){let e=c/2,f=a[0]||[];return[f,a[1]||f].map((a,c)=>{let f=a.length,g=f?b/f:0,h=0===c?-1:1,i=[{x:0,y:e}],j=0,k=0;for(let b=0;b<=f;b++){let c=Math.round(b*g);if(c>j){let a=e+(Math.round(k*e*d)||1)*h;i.push({x:j,y:a}),j=c,k=0}let f=Math.abs(a[b]||0);f>k&&(k=f)}return i.push({x:j,y:e}),i})}({channelData:a,width:e,height:f,vScale:d});for(let a of(c.beginPath(),g))if(a.length){c.moveTo(a[0].x,a[0].y);for(let b=1;b<a.length;b++){let d=a[b];c.lineTo(d.x,d.y)}}c.fill(),c.closePath()}renderWaveform(a,b,c){if(c.fillStyle=this.convertColorValues(b.waveColor),b.renderFunction)return void b.renderFunction(a,c);let d=function({channelData:a,barHeight:b,normalize:c}){var d;let e=b||1;if(!c)return e;let f=a[0];if(!f||0===f.length)return e;let g=0;for(let a=0;a<f.length;a++){let b=Math.abs(null!=(d=f[a])?d:0);b>g&&(g=b)}return g?e/g:e}({channelData:a,barHeight:b.barHeight,normalize:b.normalize});q(b)?this.renderBarWaveform(a,b,c,d):this.renderLineWaveform(a,b,c,d)}renderSingleCanvas(a,b,c,d,e,f,g){let h=this.getPixelRatio(),i=document.createElement("canvas");i.width=Math.round(c*h),i.height=Math.round(d*h),i.style.width=`${c}px`,i.style.height=`${d}px`,i.style.left=`${Math.round(e)}px`,f.appendChild(i);let j=i.getContext("2d");if(b.renderFunction?(j.fillStyle=this.convertColorValues(b.waveColor),b.renderFunction(a,j)):this.renderWaveform(a,b,j),i.width>0&&i.height>0){let a=i.cloneNode(),c=a.getContext("2d");c.drawImage(i,0,0),c.globalCompositeOperation="source-in",c.fillStyle=this.convertColorValues(b.progressColor),c.fillRect(0,0,i.width,i.height),g.appendChild(a)}}renderMultiCanvas(a,b,c,d,e,f){let g=this.getPixelRatio(),{clientWidth:h}=this.scrollContainer,i=c/g,j=function({clientWidth:a,totalWidth:b,options:c}){return r(Math.min(8e3,a,b),c)}({clientWidth:h,totalWidth:i,options:b}),k={};if(0===j)return;let l=c=>{if(c<0||c>=m||k[c])return;k[c]=!0;let g=c*j,h=Math.min(i-g,j);if((h=r(h,b))<=0)return;let l=function({channelData:a,offset:b,clampedWidth:c,totalWidth:d}){return a.map(a=>{let e=Math.floor(b/d*a.length),f=Math.floor((b+c)/d*a.length);return a.slice(e,f)})}({channelData:a,offset:g,clampedWidth:h,totalWidth:i});this.renderSingleCanvas(l,b,h,d,g,e,f)},m=Math.ceil(i/j);if(!this.isScrollable){for(let a=0;a<m;a++)l(a);return}if(s({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:i,numCanvases:m}).forEach(a=>l(a)),m>1){let a=this.on("scroll",()=>{let{scrollLeft:a}=this.scrollContainer;Object.keys(k).length>10&&(e.innerHTML="",f.innerHTML="",k={}),s({scrollLeft:a,totalWidth:i,numCanvases:m}).forEach(a=>l(a))});this.unsubscribeOnScroll.push(a)}}renderChannel(a,b,c,d){var{overlay:e}=b,f=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]])}return c}(b,["overlay"]);let g=document.createElement("div"),h=this.getHeight(f.height,f.splitChannels);g.style.height=`${h}px`,e&&d>0&&(g.style.marginTop=`-${h}px`),this.canvasWrapper.style.minHeight=`${h}px`,this.canvasWrapper.appendChild(g);let i=g.cloneNode();this.progressWrapper.appendChild(i),this.renderMultiCanvas(a,f,c,h,g,i)}render(a){return h(this,void 0,void 0,function*(){var b;this.timeouts.forEach(a=>a()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);let c=this.getPixelRatio(),d=this.scrollContainer.clientWidth,{scrollWidth:e,isScrollable:f,useParentWidth:g,width:h}=function({duration:a,minPxPerSec:b=0,parentWidth:c,fillParent:d,pixelRatio:e}){let f=Math.ceil(a*b),g=f>c,h=!!(d&&!g);return{scrollWidth:f,isScrollable:g,useParentWidth:h,width:(h?c:f)*e}}({duration:a.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:d,fillParent:this.options.fillParent,pixelRatio:c});if(this.isScrollable=f,this.wrapper.style.width=g?"100%":`${e}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=a,this.emit("render"),this.options.splitChannels)for(let c=0;c<a.numberOfChannels;c++){let d=Object.assign(Object.assign({},this.options),null==(b=this.options.splitChannels)?void 0:b[c]);this.renderChannel([a.getChannelData(c)],d,h,c)}else{let b=[a.getChannelData(0)];a.numberOfChannels>1&&b.push(a.getChannelData(1)),this.renderChannel(b,this.options,h,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(a=>a()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:a}=this.scrollContainer,{right:b}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&a!==this.scrollContainer.scrollWidth){let a,{right:c}=this.progressWrapper.getBoundingClientRect(),d=((a=2*(c-b))<0?Math.floor(a):Math.ceil(a))/2;this.scrollContainer.scrollLeft+=d}}zoom(a){this.options.minPxPerSec=a,this.reRender()}scrollIntoView(a,b=!1){let{scrollLeft:c,scrollWidth:d,clientWidth:e}=this.scrollContainer,f=a*d,g=c+e,h=e/2;if(this.isDragging)f+30>g?this.scrollContainer.scrollLeft+=30:f-30<c&&(this.scrollContainer.scrollLeft-=30);else{(f<c||f>g)&&(this.scrollContainer.scrollLeft=f-(this.options.autoCenter?h:0));let a=f-c-h;b&&this.options.autoCenter&&a>0&&(this.scrollContainer.scrollLeft+=a)}{let a=this.scrollContainer.scrollLeft,{startX:b,endX:c}=t({scrollLeft:a,scrollWidth:d,clientWidth:e});this.emit("scroll",b,c,a,a+e)}}renderProgress(a,b){if(isNaN(a))return;let c=100*a;this.canvasWrapper.style.clipPath=`polygon(${c}% 0%, 100% 0%, 100% 100%, ${c}% 100%)`,this.progressWrapper.style.width=`${c}%`,this.cursor.style.left=`${c}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${a*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(a,b)}exportImage(a,b,c){return h(this,void 0,void 0,function*(){let d=this.canvasWrapper.querySelectorAll("canvas");if(!d.length)throw Error("No waveform data");return"dataURL"===c?Promise.resolve(Array.from(d).map(c=>c.toDataURL(a,b))):Promise.all(Array.from(d).map(c=>new Promise((d,e)=>{c.toBlob(a=>{a?d(a):e(Error("Could not export image"))},a,b)})))})}}class v extends i{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;let a=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(a))};a()}stop(){this.isRunning=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class w extends i{constructor(a=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=a,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return h(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(a){(this.currentSrc=a,this._duration=void 0,a)?fetch(a).then(b=>{if(b.status>=400)throw Error(`Failed to fetch ${a}: ${b.status} (${b.statusText})`);return b.arrayBuffer()}).then(b=>this.currentSrc!==a?null:this.audioContext.decodeAudioData(b)).then(b=>{this.currentSrc===a&&(this.buffer=b,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}).catch(a=>{console.error("WebAudioPlayer load error:",a)}):(this.buffer=null,this.emit("emptied"))}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let a=this.playedDuration*this._playbackRate;(a>=this.duration||a<0)&&(a=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,a),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var a;this.paused=!0,null==(a=this.bufferNode)||a.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return h(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(a){let b=a-this.currentTime,c=this.bufferNode;null==c||c.stop(this.audioContext.currentTime+b),null==c||c.addEventListener("ended",()=>{c===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(a){return h(this,void 0,void 0,function*(){return this.audioContext.setSinkId(a)})}get playbackRate(){return this._playbackRate}set playbackRate(a){this._playbackRate=a,this.bufferNode&&(this.bufferNode.playbackRate.value=a)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(a){let b=!this.paused;b&&this._pause(),this.playedDuration=a/this._playbackRate,b&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var a,b;return null!=(a=this._duration)?a:(null==(b=this.buffer)?void 0:b.duration)||0}set duration(a){this._duration=a}get volume(){return this.gainNode.gain.value}set volume(a){this.gainNode.gain.value=a,this.emit("volumechange")}get muted(){return this._muted}set muted(a){this._muted!==a&&(this._muted=a,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(a){return/^(audio|video)\//.test(a)}getGainNode(){return this.gainNode}getChannelData(){let a=[];if(!this.buffer)return a;let b=this.buffer.numberOfChannels;for(let c=0;c<b;c++)a.push(this.buffer.getChannelData(c));return a}removeAttribute(a){switch(a){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}let x={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class y extends n{static create(a){return new y(a)}constructor(a){const b=a.media||("WebAudio"===a.backend?new w:void 0);super({media:b,mediaControls:a.mediaControls,autoplay:a.autoplay,playbackRate:a.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},x,a),this.timer=new v;const c=b?void 0:this.getMediaElement();this.renderer=new u(this.options,c),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const d=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:a,duration:b}=this.options;(d||a&&b)&&this.load(d,a,b).catch(a=>{this.emit("error",a instanceof Error?a:Error(String(a)))})})}updateProgress(a=this.getCurrentTime()){return this.renderer.renderProgress(a/this.getDuration(),this.isPlaying()),a}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let a=this.updateProgress();this.emit("timeupdate",a),this.emit("audioprocess",a),null!=this.stopAtPosition&&this.isPlaying()&&a>=this.stopAtPosition&&this.pause()}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let a=this.updateProgress();this.emit("timeupdate",a)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var a;this.emit("error",null!=(a=this.getMediaElement().error)?a:Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(a,b)=>{this.options.interact&&(this.seekTo(a),this.emit("interaction",a*this.getDuration()),this.emit("click",a,b))}),this.renderer.on("dblclick",(a,b)=>{this.emit("dblclick",a,b)}),this.renderer.on("scroll",(a,b,c,d)=>{let e=this.getDuration();this.emit("scroll",a*e,b*e,c,d)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",a=>{this.emit("dragstart",a)}),this.renderer.on("dragend",a=>{this.emit("dragend",a)}),this.renderer.on("resize",()=>{this.emit("resize")}));{let a,b=this.renderer.on("drag",b=>{var c;if(!this.options.interact)return;this.renderer.renderProgress(b),clearTimeout(a);let d=0,e=this.options.dragToSeek;this.isPlaying()?d=0:!0===e?d=200:e&&"object"==typeof e&&(d=null!=(c=e.debounceTime)?c:200),a=setTimeout(()=>{this.seekTo(b)},d),this.emit("interaction",b*this.getDuration()),this.emit("drag",b)});this.subscriptions.push(()=>{clearTimeout(a),b()})}}initPlugins(){var a;(null==(a=this.options.plugins)?void 0:a.length)&&this.options.plugins.forEach(a=>{this.registerPlugin(a)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(a=>a()),this.mediaSubscriptions=[]}setOptions(a){this.options=Object.assign({},this.options,a),a.duration&&!a.peaks&&(this.decodedData=j.createBuffer(this.exportPeaks(),a.duration)),a.peaks&&a.duration&&(this.decodedData=j.createBuffer(a.peaks,a.duration)),this.renderer.setOptions(this.options),a.audioRate&&this.setPlaybackRate(a.audioRate),null!=a.mediaControls&&(this.getMediaElement().controls=a.mediaControls)}registerPlugin(a){if(this.plugins.includes(a))return a;a._init(this),this.plugins.push(a);let b=a.once("destroy",()=>{this.plugins=this.plugins.filter(b=>b!==a),this.subscriptions=this.subscriptions.filter(a=>a!==b)});return this.subscriptions.push(b),a}unregisterPlugin(a){this.plugins=this.plugins.filter(b=>b!==a),a.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(a){return this.renderer.setScroll(a)}setScrollTime(a){let b=a/this.getDuration();this.renderer.setScrollPercentage(b)}getActivePlugins(){return this.plugins}loadAudio(a,b,c,d){return h(this,void 0,void 0,function*(){var e;if(this.emit("load",a),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,null==(e=this.abortController)||e.abort(),this.abortController=null,!b&&!c){let c=this.options.fetchParams||{};window.AbortController&&!c.signal&&(this.abortController=new AbortController,c.signal=this.abortController.signal);let d=a=>this.emit("loading",a);b=yield m.fetchBlob(a,d,c);let e=this.options.blobMimeType;e&&(b=new Blob([b],{type:e}))}this.setSrc(a,b);let f=yield new Promise(a=>{let b=d||this.getDuration();b?a(b):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>a(this.getDuration()),{once:!0}))});if(!a&&!b){let a=this.getMediaElement();a instanceof w&&(a.duration=f)}if(c)this.decodedData=j.createBuffer(c,f||0);else if(b){let a=yield b.arrayBuffer();this.decodedData=yield j.decode(a,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(a,b,c){return h(this,void 0,void 0,function*(){try{return yield this.loadAudio(a,void 0,b,c)}catch(a){throw this.emit("error",a),a}})}loadBlob(a,b,c){return h(this,void 0,void 0,function*(){try{return yield this.loadAudio("",a,b,c)}catch(a){throw this.emit("error",a),a}})}zoom(a){if(!this.decodedData)throw Error("No audio loaded");this.renderer.zoom(a),this.emit("zoom",a)}getDecodedData(){return this.decodedData}exportPeaks({channels:a=2,maxLength:b=8e3,precision:c=1e4}={}){if(!this.decodedData)throw Error("The audio has not been decoded yet");let d=Math.min(a,this.decodedData.numberOfChannels),e=[];for(let a=0;a<d;a++){let d=this.decodedData.getChannelData(a),f=[],g=d.length/b;for(let a=0;a<b;a++){let b=d.slice(Math.floor(a*g),Math.ceil((a+1)*g)),e=0;for(let a=0;a<b.length;a++){let c=b[a];Math.abs(c)>Math.abs(e)&&(e=c)}f.push(Math.round(e*c)/c)}e.push(f)}return e}getDuration(){let a=super.getDuration()||0;return(0===a||a===1/0)&&this.decodedData&&(a=this.decodedData.duration),a}toggleInteraction(a){this.options.interact=a}setTime(a){this.stopAtPosition=null,super.setTime(a),this.updateProgress(a),this.emit("timeupdate",a)}seekTo(a){let b=this.getDuration()*a;this.setTime(b)}play(a,b){let c=Object.create(null,{play:{get:()=>super.play}});return h(this,void 0,void 0,function*(){null!=a&&this.setTime(a);let d=yield c.play.call(this);return null!=b&&(this.media instanceof w?this.media.stopAt(b):this.stopAtPosition=b),d})}playPause(){return h(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(a){this.setTime(this.getCurrentTime()+a)}empty(){this.load("",[[0]],.001)}setMediaElement(a){this.unsubscribePlayerEvents(),super.setMediaElement(a),this.initPlayerEvents()}exportImage(){return h(this,arguments,void 0,function*(a="image/png",b=1,c="dataURL"){return this.renderer.exportImage(a,b,c)})}destroy(){var a;this.emit("destroy"),null==(a=this.abortController)||a.abort(),this.plugins.forEach(a=>a.destroy()),this.subscriptions.forEach(a=>a()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}y.BasePlugin=class extends i{constructor(a){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=a}onInit(){}_init(a){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=a,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(a=>a()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},y.dom=l;class z{constructor(){this.listeners={}}on(a,b,c){if(this.listeners[a]||(this.listeners[a]=new Set),null==c?void 0:c.once){let c=(...d)=>{this.un(a,c),b(...d)};return this.listeners[a].add(c),()=>this.un(a,c)}return this.listeners[a].add(b),()=>this.un(a,b)}un(a,b){var c;null==(c=this.listeners[a])||c.delete(b)}once(a,b){return this.on(a,b,{once:!0})}unAll(){this.listeners={}}emit(a,...b){this.listeners[a]&&this.listeners[a].forEach(a=>a(...b))}}class A extends z{constructor(a){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=a}onInit(){}_init(a){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=a,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(a=>a()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function B(a,b,c,d,e=3,f=0,g=100){if(!a)return()=>{};let h=new Map,i=matchMedia("(pointer: coarse)").matches,j=()=>{},k=k=>{if(k.button!==f||(h.set(k.pointerId,k),h.size>1))return;let l=k.clientX,m=k.clientY,n=!1,o=Date.now(),p=d=>{if(d.defaultPrevented||h.size>1||i&&Date.now()-o<g)return;let f=d.clientX,j=d.clientY,k=f-l,p=j-m;if(n||Math.abs(k)>e||Math.abs(p)>e){d.preventDefault(),d.stopPropagation();let{left:e,top:g}=a.getBoundingClientRect();n||(null==c||c(l-e,m-g),n=!0),b(k,p,f-e,j-g),l=f,m=j}},q=b=>{if(h.delete(b.pointerId),n){let c=b.clientX,e=b.clientY,{left:f,top:g}=a.getBoundingClientRect();null==d||d(c-f,e-g)}j()},r=a=>{h.delete(a.pointerId),a.relatedTarget&&a.relatedTarget!==document.documentElement||q(a)},s=a=>{n&&(a.stopPropagation(),a.preventDefault())},t=a=>{a.defaultPrevented||h.size>1||n&&a.preventDefault()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",q),document.addEventListener("pointerout",r),document.addEventListener("pointercancel",r),document.addEventListener("touchmove",t,{passive:!1}),document.addEventListener("click",s,{capture:!0}),j=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",q),document.removeEventListener("pointerout",r),document.removeEventListener("pointercancel",r),document.removeEventListener("touchmove",t),setTimeout(()=>{document.removeEventListener("click",s,{capture:!0})},10)}};return a.addEventListener("pointerdown",k),()=>{j(),a.removeEventListener("pointerdown",k),h.clear()}}function C(a,b,c){let d=function a(b,c){let d=c.xmlns?document.createElementNS(c.xmlns,b):document.createElement(b);for(let[b,e]of Object.entries(c))if("children"===b&&e)for(let[b,c]of Object.entries(e))c instanceof Node?d.appendChild(c):"string"==typeof c?d.appendChild(document.createTextNode(c)):d.appendChild(a(b,c));else"style"===b?Object.assign(d.style,e):"textContent"===b?d.textContent=e:d.setAttribute(b,e.toString());return d}(a,b||{});return null==c||c.appendChild(d),d}class D extends z{constructor(a,b,c=0){var d,e,f,g,h,i,j,k,l,m;super(),this.totalDuration=b,this.numberOfChannels=c,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.updatingSide=void 0,this.isRemoved=!1,this.subscriptions=[],this.id=a.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(a.start),this.end=this.clampPosition(null!=(d=a.end)?d:a.start),this.drag=null==(e=a.drag)||e,this.resize=null==(f=a.resize)||f,this.resizeStart=null==(g=a.resizeStart)||g,this.resizeEnd=null==(h=a.resizeEnd)||h,this.color=null!=(i=a.color)?i:"rgba(0, 0, 0, 0.1)",this.minLength=null!=(j=a.minLength)?j:this.minLength,this.maxLength=null!=(k=a.maxLength)?k:this.maxLength,this.channelIdx=null!=(l=a.channelIdx)?l:-1,this.contentEditable=null!=(m=a.contentEditable)?m:this.contentEditable,this.element=this.initElement(),this.setContent(a.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(a){return Math.max(0,Math.min(this.totalDuration,a))}setPart(){var a;let b=this.start===this.end;null==(a=this.element)||a.setAttribute("part",`${b?"marker":"region"} ${this.id}`)}addResizeHandles(a){let b={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},c=C("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},b),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},a),d=C("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},b),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},a);this.subscriptions.push(B(c,a=>this.onResize(a,"start"),()=>null,()=>this.onEndResizing("start"),1),B(d,a=>this.onResize(a,"end"),()=>null,()=>this.onEndResizing("end"),1))}removeResizeHandles(a){let b=a.querySelector('[part*="region-handle-left"]'),c=a.querySelector('[part*="region-handle-right"]');b&&a.removeChild(b),c&&a.removeChild(c)}initElement(){if(this.isRemoved)return null;let a=this.start===this.end,b=0,c=100;this.channelIdx>=0&&this.numberOfChannels>0&&this.channelIdx<this.numberOfChannels&&(b=(c=100/this.numberOfChannels)*this.channelIdx);let d=C("div",{style:{position:"absolute",top:`${b}%`,height:`${c}%`,backgroundColor:a?"none":this.color,borderLeft:a?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!a&&this.resize&&this.addResizeHandles(d),d}renderPosition(){if(!this.element)return;let a=this.start/this.totalDuration,b=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*a+"%",this.element.style.right=100*b+"%"}toggleCursor(a){var b;this.drag&&(null==(b=this.element)?void 0:b.style)&&(this.element.style.cursor=a?"grabbing":"grab")}initMouseEvents(){let{element:a}=this;a&&(a.addEventListener("click",a=>this.emit("click",a)),a.addEventListener("mouseenter",a=>this.emit("over",a)),a.addEventListener("mouseleave",a=>this.emit("leave",a)),a.addEventListener("dblclick",a=>this.emit("dblclick",a)),a.addEventListener("pointerdown",()=>this.toggleCursor(!0)),a.addEventListener("pointerup",()=>this.toggleCursor(!1)),this.subscriptions.push(B(a,a=>this.onMove(a),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")})),this.contentEditable&&this.content&&(this.contentClickListener=a=>this.onContentClick(a),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)))}_onUpdate(a,b,c){var d;if(!(null==(d=this.element)?void 0:d.parentElement))return;let{width:e}=this.element.parentElement.getBoundingClientRect(),f=a/e*this.totalDuration,g=b&&"start"!==b?this.start:this.start+f,h=b&&"end"!==b?this.end:this.end+f,i=void 0!==c;i&&this.updatingSide&&this.updatingSide!==b&&("start"===this.updatingSide?g=c:h=c),g=Math.max(0,g);let j=(h=Math.min(this.totalDuration,h))-g;this.updatingSide=b;let k=j>=this.minLength&&j<=this.maxLength;g<=h&&(k||i)&&(this.start=g,this.end=h,this.renderPosition(),this.emit("update",b))}onMove(a){this.drag&&this._onUpdate(a)}onResize(a,b){this.resize&&(this.resizeStart||"start"!==b)&&(this.resizeEnd||"end"!==b)&&this._onUpdate(a,b)}onEndResizing(a){this.resize&&(this.emit("update-end",a),this.updatingSide=void 0)}onContentClick(a){a.stopPropagation(),a.target.focus(),this.emit("click",a)}onContentBlur(){this.emit("update-end")}_setTotalDuration(a){this.totalDuration=a,this.renderPosition()}play(a){this.emit("play",a&&this.end!==this.start?this.end:void 0)}getContent(a=!1){var b;return a?this.content||void 0:this.element instanceof HTMLElement?(null==(b=this.content)?void 0:b.innerHTML)||void 0:""}setContent(a){var b;if(this.element)if(this.content&&this.contentEditable&&(this.contentClickListener&&this.content.removeEventListener("click",this.contentClickListener),this.contentBlurListener&&this.content.removeEventListener("blur",this.contentBlurListener)),null==(b=this.content)||b.remove(),a){if("string"==typeof a){let b=this.start===this.end;this.content=C("div",{style:{padding:`0.2em ${b?.2:.4}em`,display:"inline-block"},textContent:a})}else this.content=a;this.contentEditable&&(this.content.contentEditable="true",this.contentClickListener=a=>this.onContentClick(a),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(a){var b,c;if(this.element){if(a.color&&(this.color=a.color,this.element.style.backgroundColor=this.color),void 0!==a.drag&&(this.drag=a.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==a.start||void 0!==a.end){let d=this.start===this.end;this.start=this.clampPosition(null!=(b=a.start)?b:this.start),this.end=this.clampPosition(null!=(c=a.end)?c:d?this.start:this.end),this.renderPosition(),this.setPart()}if(a.content&&this.setContent(a.content),a.id&&(this.id=a.id,this.setPart()),void 0!==a.resize&&a.resize!==this.resize){let b=this.start===this.end;this.resize=a.resize,this.resize&&!b?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==a.resizeStart&&(this.resizeStart=a.resizeStart),void 0!==a.resizeEnd&&(this.resizeEnd=a.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach(a=>a()),this.element&&(this.element.remove(),this.element=null)}}class E extends A{constructor(a){super(a),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(a){return new E(a)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer),this.subscriptions.push(this.wavesurfer.on("ready",a=>{this.regions.forEach(b=>b._setTotalDuration(a))}));let a=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",b=>{let c=this.regions.filter(a=>a.start<=b&&(a.end===a.start?a.start+.05:a.end)>=b);c.forEach(b=>{a.includes(b)||this.emit("region-in",b)}),a.forEach(a=>{c.includes(a)||this.emit("region-out",a)}),a=c}))}initRegionsContainer(){return C("div",{part:"regions-container",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(a){a.content&&setTimeout(()=>{let b=a.content,c=b.getBoundingClientRect(),d=this.regions.map(b=>{if(b===a||!b.content)return 0;let d=b.content.getBoundingClientRect();return c.left<d.left+d.width&&d.left<c.left+c.width?d.height:0}).reduce((a,b)=>a+b,0);b.style.marginTop=`${d}px`},10)}adjustScroll(a){var b,c;if(!a.element)return;let d=null==(c=null==(b=this.wavesurfer)?void 0:b.getWrapper())?void 0:c.parentElement;if(!d)return;let{clientWidth:e,scrollWidth:f}=d;if(f<=e)return;let g=d.getBoundingClientRect(),h=a.element.getBoundingClientRect(),i=h.left-g.left,j=h.right-g.left;i<0?d.scrollLeft+=i:j>e&&(d.scrollLeft+=j-e)}virtualAppend(a,b,c){let d=()=>{if(!this.wavesurfer)return;let d=this.wavesurfer.getWidth(),e=this.wavesurfer.getScroll(),f=b.clientWidth,g=this.wavesurfer.getDuration(),h=Math.round(a.start/g*f),i=h+(Math.round((a.end-a.start)/g*f)||1)>e&&h<e+d;i&&!c.parentElement?b.appendChild(c):!i&&c.parentElement&&c.remove()};setTimeout(()=>{if(!this.wavesurfer||!a.element)return;d();let b=this.wavesurfer.on("scroll",d),c=this.wavesurfer.on("zoom",d),e=this.wavesurfer.on("resize",d);this.subscriptions.push(b,c,e),a.once("remove",()=>{b(),c(),e()})},0)}saveRegion(a){if(!a.element)return;this.virtualAppend(a,this.regionsContainer,a.element),this.avoidOverlapping(a),this.regions.push(a);let b=[a.on("update",b=>{b||this.adjustScroll(a),this.emit("region-update",a,b)}),a.on("update-end",b=>{this.avoidOverlapping(a),this.emit("region-updated",a,b)}),a.on("play",b=>{var c;null==(c=this.wavesurfer)||c.play(a.start,b)}),a.on("click",b=>{this.emit("region-clicked",a,b)}),a.on("dblclick",b=>{this.emit("region-double-clicked",a,b)}),a.on("content-changed",()=>{this.emit("region-content-changed",a)}),a.once("remove",()=>{b.forEach(a=>a()),this.regions=this.regions.filter(b=>b!==a),this.emit("region-removed",a)})];this.subscriptions.push(...b),this.emit("region-created",a)}addRegion(a){var b,c;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let d=this.wavesurfer.getDuration(),e=new D(a,d,null==(c=null==(b=this.wavesurfer)?void 0:b.getDecodedData())?void 0:c.numberOfChannels);return this.emit("region-initialized",e),d?this.saveRegion(e):this.subscriptions.push(this.wavesurfer.once("ready",a=>{e._setTotalDuration(a),this.saveRegion(e)})),e}enableDragSelection(a,b=3){var c;let d=null==(c=this.wavesurfer)?void 0:c.getWrapper();if(!(d&&d instanceof HTMLElement))return()=>{};let e=null,f=0,g=0;return B(d,(a,b,c)=>{e&&e._onUpdate(a,c>f?"end":"start",g)},b=>{var c,d;if(f=b,!this.wavesurfer)return;let h=this.wavesurfer.getDuration(),i=null==(d=null==(c=this.wavesurfer)?void 0:c.getDecodedData())?void 0:d.numberOfChannels,{width:j}=this.wavesurfer.getWrapper().getBoundingClientRect();g=f/j*h,e=new D(Object.assign(Object.assign({},a),{start:b/j*h,end:(b+5)/j*h}),h,i),this.emit("region-initialized",e),e.element&&this.regionsContainer.appendChild(e.element)},()=>{e&&(this.saveRegion(e),e.updatingSide=void 0,e=null)},b)}clearRegions(){this.regions.slice().forEach(a=>a.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}function F(){let a=(0,d.useTranslations)("Tools.audio-cutter.ui"),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(0),[n,o]=(0,c.useState)({start:0,end:0}),[p,q]=(0,c.useState)(!1),r=(0,c.useRef)(null),s=(0,c.useRef)(null),t=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(!h||!r.current)return;let a=y.create({container:r.current,waveColor:"#4F46E5",progressColor:"#818CF8",cursorColor:"#312E81",barWidth:2,barGap:1,height:128}),b=a.registerPlugin(E.create());return t.current=b,a.loadBlob(h),a.on("ready",()=>{m(a.getDuration()),b.addRegion({start:0,end:a.getDuration()/2,color:"rgba(79, 70, 229, 0.2)",drag:!0,resize:!0})}),a.on("play",()=>k(!0)),a.on("pause",()=>k(!1)),b.on("region-updated",a=>{o({start:a.start,end:a.end})}),b.on("region-created",a=>{o({start:a.start,end:a.end});let c=b.getRegions();c.length>1&&c[0].remove()}),s.current=a,()=>{a.destroy()}},[h]);let u=async()=>{if(!h||!s.current)return;q(!0);let b=g.toast.loading(a("processing"));try{let c=new(window.AudioContext||window.webkitAudioContext),d=await h.arrayBuffer(),e=await c.decodeAudioData(d),f=n.start,i=n.end,j=e.sampleRate,k=Math.floor(f*j),l=Math.floor(i*j)-k,m=c.createBuffer(e.numberOfChannels,l,j);for(let a=0;a<e.numberOfChannels;a++){let b=e.getChannelData(a),c=m.getChannelData(a);for(let a=0;a<l;a++)c[a]=b[k+a]}let o=await v(m),p=URL.createObjectURL(o),q=document.createElement("a");q.href=p,q.download=`trimmed-${h.name.replace(/\.[^/.]+$/,"")}.wav`,q.click(),g.toast.success(a("success"),{id:b})}catch(c){console.error(c),g.toast.error(a("error"),{id:b})}finally{q(!1)}},v=a=>new Promise(b=>{let c=a.length*a.numberOfChannels*2+44,d=new ArrayBuffer(c),e=new DataView(d),f=[],g=0,h=0;j(0x46464952),j(c-8),j(0x45564157),j(0x20746d66),j(16),i(1),i(a.numberOfChannels),j(a.sampleRate),j(2*a.sampleRate*a.numberOfChannels),i(2*a.numberOfChannels),i(16),j(0x61746164),j(c-h-4);for(let b=0;b<a.numberOfChannels;b++)f.push(a.getChannelData(b));for(;h<a.length;){for(let b=0;b<a.numberOfChannels;b++){let a=Math.max(-1,Math.min(1,f[b][h]));a=(.5+a<0?32768*a:32767*a)|0,e.setInt16(44+g,a,!0),g+=2}h++}function i(a){e.setUint16(h,a,!0),h+=2}function j(a){e.setUint32(h,a,!0),h+=4}b(new Blob([d],{type:"audio/wav"}))});return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,b.jsx)(g.Toaster,{position:"bottom-right"}),(0,b.jsx)(f.Card,{className:"p-8",children:h?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-medium text-gray-700",children:h.name}),(0,b.jsx)(e.Button,{onClick:()=>i(null),variant:"ghost",size:"sm",className:"text-gray-500 hover:text-red-500",children:"âœ•"})]}),(0,b.jsx)("div",{ref:r,className:"w-full"}),(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-4 rounded-lg",children:[(0,b.jsxs)("div",{className:"space-x-4",children:[(0,b.jsx)(e.Button,{onClick:()=>{s.current&&s.current.playPause()},className:"bg-blue-600 hover:bg-blue-700 text-white",children:j?a("pause"):a("play")}),(0,b.jsx)("span",{className:"text-sm text-gray-600 font-mono",children:a("selection",{start:n.start.toFixed(2),end:n.end.toFixed(2)})})]}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:a("duration",{seconds:l.toFixed(2)})})]}),(0,b.jsx)(e.Button,{onClick:u,disabled:p,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 text-lg",children:p?a("processing"):a("trim")})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-500 transition-colors",children:[(0,b.jsx)("input",{type:"file",accept:"audio/*",onChange:a=>{a.target.files&&a.target.files[0]&&i(a.target.files[0])},className:"hidden",id:"audio-upload"}),(0,b.jsxs)("label",{htmlFor:"audio-upload",className:"cursor-pointer flex flex-col items-center gap-4",children:[(0,b.jsx)("div",{className:"bg-blue-50 p-4 rounded-full",children:(0,b.jsx)("svg",{className:"w-12 h-12 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("span",{className:"text-xl font-semibold text-gray-700 block",children:a("selectAudio")}),(0,b.jsx)("span",{className:"text-sm text-gray-500 block",children:a("dragDrop")})]})]})]})}),(0,b.jsx)("div",{className:"text-center text-sm text-gray-500",children:a("processingNote")})]})}a.s(["default",()=>F],78620)}];

//# sourceMappingURL=574c9_app_%5Blocale%5D_tools_audio-cutter_AudioCutterClient_tsx_69945569._.js.map